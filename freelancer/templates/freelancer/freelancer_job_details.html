{% extends 'freelancer/base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h2>{{ job.title }}</h2>
        </div>
        <div class="card-body">
            <h5 class="card-title"><strong>Category:</strong> {{ job.category }}</h5>
            <p class="card-text"><strong>Description:</strong> {{ job.description }}</p>
            <p class="card-text"><strong>Budget:</strong> ${{ job.budget }}</p>
            <p class="card-text"><strong>Status:</strong> 
                <span class="badge {% if job.status == 'Open' %}bg-success{% else %}bg-danger{% endif %}">
                    {{ job.status }}
                </span>
            </p>
            <p class="card-text"><strong>Deadline:</strong> {{ job.deadline|date:"M d, Y" }}</p>
            <p class="card-text"><strong>Time Remaining:</strong> <span id="countdown"></span></p>
            
            <!-- Tags Section -->
            <p class="card-text"><strong>Tags:</strong>
                {% for tag in job.tags.all %}
                    <span class="badge bg-info text-dark">{{ tag.name }}</span>
                {% empty %}
                    <span class="text-muted">No tags available.</span>
                {% endfor %}
            </p>
            
                        <!-- Progress Bar -->
            {% if job.max_applicants %}
            <p class="card-text"><strong>Applications:</strong> {{ job.current_applicants }} / {{ job.max_applicants }}</p>
            <div class="progress">
                <div class="progress-bar bg-success" role="progressbar"
                    style="width: {{ application_percentage|floatformat:2 }}" 
                    aria-valuenow="{{ job.current_applicants }}" 
                    aria-valuemin="0" 
                    aria-valuemax="{{ job.max_applicants }}">
                    {{ application_percentage|floatformat:2 }}%
                </div>
            </div>
            {% endif %}

        </div>
        <div class="card-footer d-flex justify-content-between">
            <a href="{% url 'freelancer_available_jobs' %}" class="btn btn-secondary">
                Back to Available Jobs
            </a>
            {% if job.status == 'Open' %}
            <a href="{% url 'apply_for_job' job.id %}" class="btn btn-success">
                Apply for Job
            </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Countdown Timer Script -->
<script>
    const deadline = new Date("{{ job.deadline|date:'Y-m-d H:i:s' }}").getTime();
    const countdown = document.getElementById('countdown');
    const timer = setInterval(() => {
        const now = new Date().getTime();
        const distance = deadline - now;

        if (distance <= 0) {
            clearInterval(timer);
            countdown.textContent = "Deadline passed.";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        countdown.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }, 1000);
</script>
{% endblock %}
